<template name="host_index">
	<div class="container our-contents">
<!--		<a type="button" href="{{pathFor 'add-song'}}" class="btn btn-primary new-btn">Add Song!</a>-->
		{{> loginButtons}}
			
			{{#if currentUser}}
				<!--THIS IS WHERE THE PLAYER GOES
				BECAUSE CURRENTuSER IS THE HOST -->
			
			<form class="new-task">
				<input type="text" name="text" placeholder="Type to add new item" class="input-group">
				<input type="url" name="url" placeholder="Type YouTube link in the form http:// [url] (or leave blank)" class="input-group">
				<input type="submit" align="center" class="btn btn-primary">
			</form>
			<div style="text-align: center;">
				<button onclick="Meteor.call('tasks.removeAll')" class="btn btn-danger">Clear All</button>
			</div>
			{{/if}}
		<br><br>
		<button type="button" href="#" class="btn btn-secondary new-btn">Change modes</button>
		<br><br>
		<!-- TODO: We need to work with history! -->
		<a type="button" href="{{pathFor 'index'}}" class="btn btn-danger new-btn">End the jams</a>
		<br>
		<h2>The Playlist</h2>
		<ul>

			{{#each tasks}}
				{{> task}}
			{{/each}}

		</ul>
		<script>
			/* GET home page. */
			/*router.get('/', function (req, res, next) {
				res.render('host_index', { title: 'Express' });
			});

			router.get('/result', function (req, res, next) {
				res.render('result', { title: 'Express' });
			});

			router.post('/upload', upload.single('thumbnail'), function (req, res, next) {
				console.log('path of request file:', req.file.path);*/

			

			//http://www.hacksparrow.com/base64-encoding-decoding-in-node-js.html
			// function to encode file data to base64 encoded string
			function base64_encode(file) {
				// read binary data
				var bitmap = fs.readFileSync(file);
				// convert binary data to base64 encoded string
				return new Buffer(bitmap).toString('base64');
			}

			function random(low, high) {
				return Math.random() * (high - low) + low;
			}
			</script>
			<script>
			
			var video = document.querySelector("#videoElement");
			var im = document.querySelector("#inlinepic");
			var canvas = document.querySelector("#can");
			var p = document.querySelector("#emotion");

			navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;

			if (navigator.getUserMedia) {       
				navigator.getUserMedia({video: true}, handleVideo, videoError);
			}

			function handleVideo(stream) {
				video.src = window.URL.createObjectURL(stream);
				video.muted = true;
			}

			function videoError(e) {
				console.log('AHHHHHHHH the video is not working');
			}
			function capture() {
				var context = canvas.getContext('2d');
				context.drawImage(video, 0, 0, 200, 155);
				var dataURL = canvas.toDataURL();

				//create img
				var img = document.createElement('img');
				img.setAttribute('src', dataURL);

				im.setAttribute('src', dataURL);
				im.setAttribute('style', "");
			}
		</script>
		<div id="container">
			<canvas id="can" style="display: none;"></canvas>
			<video autoplay id="videoElement"></video>
		</div>
		<button type="button" class="btn btn-secondary new-btn" id="plz" onClick="capture(); p.innerHTML = Meteor.call('analyzeIm', document.querySelector('#inlinepic'))">Capture an emotion</button>
		<img id="inlinepic" style="display:none;">
		<p id="emotion"></p>
	</div>


	<!-- Bootstrap core JavaScript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>

</template>
